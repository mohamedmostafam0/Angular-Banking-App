<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="transfer-page">
  <div class="header">
    <h1>Recurring Payments</h1>
    <p>Schedule and manage your recurring payments.</p>
  </div>

  <p-toolbar>
    <div class="p-toolbar-group-end">
      <p-button
        label="Schedule new Payment"
        icon="pi pi-plus"
        (onClick)="navigateToAddPayment()"
        styleClass="SetPaymentButton"
        class="SetPaymentButton"
      ></p-button>

      <button></button>
    </div>
  </p-toolbar>

  <p-card header="Scheduled Payments" class="mt-5">
    <p-table
      [value]="recurringPayments"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Utility</th>
          <th>Amount</th>
          <th>Frequency</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-payment>
        <tr>
          <td>{{ payment.selectedUtility }}</td>
          <td>{{ payment.amount | currency : "USD" }}</td>
          <td>{{ payment.frequency }}</td>
          <td>{{ payment.startDate | date : "MM/dd/yyyy" }}</td>
          <td>
            {{
              payment.endDate ? (payment.endDate | date : "MM/dd/yyyy") : "N/A"
            }}
          </td>
          <td>
            <p-button
              icon="pi pi-pencil"
              styleClass="p-button-info p-button-text"
              (click)="editPayment(payment)"
            ></p-button>
            <p-button
              icon="pi pi-trash"
              styleClass="p-button-danger p-button-text"
              (onClick)="deletePayment(payment)"
            >
            </p-button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<p-dialog
  header="Edit Recurring Payment"
  [(visible)]="displayEditDialog"
  [modal]="true"
  [style]="{ width: '450px' }"
>
  <form [formGroup]="editPaymentForm" (ngSubmit)="savePayment()">
    <div class="p-fluid">
      <div class="field">
        <label for="editSelectedUtility">Selected Utility</label>
        <input
          id="editSelectedUtility"
          type="text"
          pInputText
          formControlName="selectedUtility"
          [readonly]="true"
        />
      </div>
      <div class="field">
        <label for="editAmount">Amount</label>
        <p-inputNumber
          id="editAmount"
          formControlName="amount"
          mode="currency"
          currency="USD"
          locale="en-US"
        ></p-inputNumber>
      </div>
      <div class="field">
        <label for="editFrequency">Frequency</label>
        <p-dropdown
          id="editFrequency"
          [options]="frequencies"
          formControlName="frequency"
          placeholder="Select a frequency"
        ></p-dropdown>
      </div>
      <div class="p-grid">
        <div class="field p-col-6">
          <label for="editStartDate">Start Date</label>
          <p-calendar
            id="editStartDate"
            formControlName="startDate"
            [showIcon]="true"
          ></p-calendar>
        </div>
        <div class="field p-col-6">
          <label for="editEndDate">End Date (Optional)</label>
          <p-calendar
            id="editEndDate"
            formControlName="endDate"
            [showIcon]="true"
          ></p-calendar>
        </div>
      </div>
    </div>
    <div class="flex justify-content-end mt-3">
      <button
        pButton
        type="submit"
        label="Save"
        icon="pi pi-check"
        [disabled]="editPaymentForm.invalid"
      ></button>
    </div>
  </form>
</p-dialog>
