<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="transfer-page">
  <div class="header">
    <h1>Recurring Payments</h1>
    <p>Schedule and manage your recurring payments.</p>
  </div>

  <p-card>
    <p-splitter styleClass="mb-5" [panelSizes]="[35, 65]">
      <ng-template pTemplate="form">
        <div class="flex align-items-center h-full">
          <div class="instructions">
            <h2>Instructions for Recurring Payments</h2>
            <h4>Follow these steps to schedule a recurring payment.</h4>
            <ul>
              <li>
                <strong>Select Utility:</strong> Choose the utility you want to
                pay for from the carousel.
              </li>
              <li>
                <strong>Enter Amount:</strong> Specify the amount for each
                payment.
              </li>
              <li>
                <strong>Set Frequency and Dates:</strong> Select how often the
                payment should occur and the start and end dates.
              </li>
              <li>
                <strong>Review and Confirm:</strong> Click "Schedule Payment" to
                set up the recurring payment.
              </li>
            </ul>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate>
        <div class="flex align-items-center h-full" style="width: 100%">
          <div class="col-12 flex">
            <div class="carousel-container">
              <p-carousel
                [value]="utilities"
                [numVisible]="3"
                [numScroll]="1"
                [responsiveOptions]="responsiveOptions"
              >
                <ng-template let-utility pTemplate="item">
                  <div class="utility-item">
                    <div class="utility-item-content">
                      <div class="mb-3 text-center">
                        <img
                          *ngIf="utility.logo"
                          [src]="utility.logo"
                          [alt]="utility.name"
                          class="product-image"
                        />
                        <i
                          *ngIf="!utility.logo"
                          [class]="'pi ' + utility.icon"
                          style="font-size: 3rem"
                        ></i>
                      </div>
                      <div class="text-center">
                        <h4 class="mb-1">{{ utility.name }}</h4>
                      </div>
                    </div>
                  </div>
                </ng-template>
              </p-carousel>
            </div>
            <form
              [formGroup]="recurringPaymentForm"
              (ngSubmit)="schedulePayment()"
              class="mt-5"
            >
              <div class="p-fluid">
                <div class="field">
                  <label for="selectedUtility">Selected Utility</label>
                  <input
                    id="selectedUtility"
                    type="text"
                    pInputText
                    formControlName="selectedUtility"
                    [readonly]="true"
                  />
                </div>
                <div class="field">
                  <label for="amount">Amount</label>
                  <p-inputNumber
                    id="amount"
                    formControlName="amount"
                    mode="currency"
                    currency="USD"
                    locale="en-US"
                  ></p-inputNumber>
                </div>
                <div class="field">
                  <label for="frequency">Frequency</label>
                  <p-dropdown
                    id="frequency"
                    [options]="frequencies"
                    formControlName="frequency"
                    placeholder="Select a frequency"
                  ></p-dropdown>
                </div>
                <div class="field">
                  <label for="startDate">Start Date</label>
                  <p-calendar
                    id="startDate"
                    formControlName="startDate"
                    [showIcon]="true"
                  ></p-calendar>
                </div>
                <div class="field">
                  <label for="endDate">End Date (Optional)</label>
                  <p-calendar
                    id="endDate"
                    formControlName="endDate"
                    [showIcon]="true"
                  ></p-calendar>
                </div>
                <div class="flex justify-content-end mt-3">
                  <button
                    pButton
                    type="submit"
                    label="Schedule Payment"
                    [disabled]="recurringPaymentForm.invalid"
                  ></button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </ng-template>
    </p-splitter>
  </p-card>

  <p-card header="Scheduled Payments" class="mt-5">
    <p-table
      [value]="recurringPayments"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Utility</th>
          <th>Amount</th>
          <th>Frequency</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-payment>
        <tr>
          <td>{{ payment.selectedUtility }}</td>
          <td>{{ payment.amount | currency : "USD" }}</td>
          <td>{{ payment.frequency }}</td>
          <td>{{ payment.startDate | date : "MM/dd/yyyy" }}</td>
          <td>
            {{
              payment.endDate ? (payment.endDate | date : "MM/dd/yyyy") : "N/A"
            }}
          </td>
          <td>
            <button
              pButton
              pRipple
              icon="pi pi-pencil"
              class="p-button-info p-button-text"
              (click)="editPayment(payment)"
            ></button>
            <button
              pButton
              pRipple
              icon="pi pi-trash"
              class="p-button-danger p-button-text"
              (click)="deletePayment(payment)"
            ></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<p-dialog
  header="Edit Recurring Payment"
  [(visible)]="displayEditDialog"
  [modal]="true"
  [style]="{ width: '450px' }"
>
  <form [formGroup]="editPaymentForm" (ngSubmit)="savePayment()">
    <div class="p-fluid">
      <div class="field">
        <label for="editSelectedUtility">Selected Utility</label>
        <input
          id="editSelectedUtility"
          type="text"
          pInputText
          formControlName="selectedUtility"
          [readonly]="true"
        />
      </div>
      <div class="field">
        <label for="editAmount">Amount</label>
        <p-inputNumber
          id="editAmount"
          formControlName="amount"
          mode="currency"
          currency="USD"
          locale="en-US"
        ></p-inputNumber>
      </div>
      <div class="field">
        <label for="editFrequency">Frequency</label>
        <p-dropdown
          id="editFrequency"
          [options]="frequencies"
          formControlName="frequency"
          placeholder="Select a frequency"
        ></p-dropdown>
      </div>
      <div class="field">
        <label for="editStartDate">Start Date</label>
        <p-calendar
          id="editStartDate"
          formControlName="startDate"
          [showIcon]="true"
        ></p-calendar>
      </div>
      <div class="field">
        <label for="editEndDate">End Date (Optional)</label>
        <p-calendar
          id="editEndDate"
          formControlName="endDate"
          [showIcon]="true"
        ></p-calendar>
      </div>
    </div>
    <div class="flex justify-content-end mt-3">
      <button
        pButton
        type="submit"
        label="Save"
        icon="pi pi-check"
        [disabled]="editPaymentForm.invalid"
      ></button>
    </div>
  </form>
</p-dialog>
